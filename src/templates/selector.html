<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitHub Project Selector</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        padding: 20px;
        font-family: var(--vscode-font-family);
        color: var(--vscode-foreground);
        background-color: var(--vscode-editor-background);
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      .header {
        margin-bottom: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 28px;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .header p {
        color: var(--vscode-descriptionForeground);
        font-size: 14px;
      }

      .search-section {
        background-color: var(--vscode-sideBar-background);
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 24px;
        border: 1px solid var(--vscode-panel-border);
      }

      .input-group {
        display: flex;
        gap: 12px;
        margin-bottom: 12px;
      }

      input[type="text"] {
        flex: 1;
        padding: 10px 14px;
        background-color: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
        border: 1px solid var(--vscode-input-border);
        border-radius: 4px;
        font-size: 14px;
        font-family: var(--vscode-font-family);
      }

      input[type="text"]:focus {
        outline: none;
        border-color: var(--vscode-focusBorder);
      }

      input[type="text"]::placeholder {
        color: var(--vscode-input-placeholderForeground);
      }

      button {
        padding: 10px 24px;
        background-color: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      button:hover:not(:disabled) {
        background-color: var(--vscode-button-hoverBackground);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .hint {
        font-size: 12px;
        color: var(--vscode-descriptionForeground);
        margin-top: 8px;
      }

      .results-section {
        display: none;
      }

      .results-section.visible {
        display: block;
      }

      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .results-header h2 {
        font-size: 18px;
        font-weight: 600;
      }

      .results-count {
        color: var(--vscode-descriptionForeground);
        font-size: 14px;
      }

      .projects-list {
        display: grid;
        gap: 12px;
      }

      .project-card {
        background-color: var(--vscode-sideBar-background);
        border: 1px solid var(--vscode-panel-border);
        border-radius: 6px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .project-card:hover {
        border-color: var(--vscode-focusBorder);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transform: translateY(-2px);
      }

      .project-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 8px;
      }

      .project-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--vscode-foreground);
      }

      .project-number {
        color: var(--vscode-descriptionForeground);
        font-size: 12px;
        font-family: monospace;
      }

      .project-description {
        color: var(--vscode-descriptionForeground);
        font-size: 13px;
        line-height: 1.5;
        margin-bottom: 8px;
      }

      .project-meta {
        display: flex;
        gap: 12px;
        font-size: 12px;
      }

      .project-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .project-badge.open {
        background-color: #28a745;
        color: white;
      }

      .project-badge.closed {
        background-color: #dc3545;
        color: white;
      }

      .project-badge.public {
        background-color: #0366d6;
        color: white;
      }

      .project-badge.private {
        background-color: #6a737d;
        color: white;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: var(--vscode-descriptionForeground);
      }

      .spinner {
        display: inline-block;
        width: 30px;
        height: 30px;
        border: 3px solid var(--vscode-panel-border);
        border-top-color: var(--vscode-focusBorder);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 12px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .error {
        background-color: var(--vscode-inputValidation-errorBackground);
        border: 1px solid var(--vscode-inputValidation-errorBorder);
        color: var(--vscode-errorForeground);
        padding: 12px 16px;
        border-radius: 4px;
        margin-top: 12px;
        font-size: 13px;
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        color: var(--vscode-descriptionForeground);
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ðŸš€ GitHub Projects</h1>
        <p>Search for projects by GitHub username or organization</p>
      </div>

      <div class="search-section">
        <div class="input-group">
          <input
            type="text"
            id="ownerInput"
            placeholder="Enter GitHub username or organization (e.g., microsoft, octocat)"
            autocomplete="off"
          />
          <button id="searchButton">Search</button>
        </div>
        <div class="hint">
          ðŸ’¡ Tip: You'll see public projects and any projects you have access to
        </div>
        <div id="errorContainer"></div>
      </div>

      <div id="loadingContainer" class="loading" style="display: none">
        <div class="spinner"></div>
        <p>Loading projects...</p>
      </div>

      <div id="loadingProjectContainer" class="loading" style="display: none">
        <div class="spinner"></div>
        <p id="loadingProjectMessage">Loading project...</p>
      </div>

      <div id="resultsSection" class="results-section">
        <div class="results-header">
          <h2>Projects</h2>
          <span class="results-count" id="resultsCount"></span>
        </div>
        <div id="projectsList" class="projects-list"></div>
      </div>
    </div>

    <script>
      const vscode = acquireVsCodeApi();

      const ownerInput = document.getElementById("ownerInput");
      const searchButton = document.getElementById("searchButton");
      const searchSection = document.querySelector(".search-section");
      const loadingContainer = document.getElementById("loadingContainer");
      const loadingProjectContainer = document.getElementById(
        "loadingProjectContainer",
      );
      const loadingProjectMessage = document.getElementById(
        "loadingProjectMessage",
      );
      const resultsSection = document.getElementById("resultsSection");
      const projectsList = document.getElementById("projectsList");
      const resultsCount = document.getElementById("resultsCount");
      const errorContainer = document.getElementById("errorContainer");

      let currentOwner = "";

      searchButton.addEventListener("click", () => {
        searchProjects();
      });

      ownerInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          searchProjects();
        }
      });

      function searchProjects() {
        const owner = ownerInput.value.trim();

        if (!owner) {
          showError("Please enter a GitHub username or organization");
          return;
        }

        currentOwner = owner;
        clearError();

        vscode.postMessage({
          command: "searchProjects",
          owner: owner,
        });
      }

      function showError(message) {
        errorContainer.innerHTML = `<div class="error">${message}</div>`;
      }

      function clearError() {
        errorContainer.innerHTML = "";
      }

      window.addEventListener("message", (event) => {
        const message = event.data;

        switch (message.command) {
          case "searchStarted":
            searchButton.disabled = true;
            loadingContainer.style.display = "block";
            resultsSection.classList.remove("visible");
            clearError();
            break;

          case "searchCompleted":
            searchButton.disabled = false;
            loadingContainer.style.display = "none";
            displayProjects(message.projects);
            break;

          case "searchError":
            searchButton.disabled = false;
            loadingContainer.style.display = "none";
            showError(`Error: ${message.error}`);
            break;
        }
      });

      function displayProjects(projects) {
        if (!projects || projects.length === 0) {
          projectsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“‚</div>
                        <p>No projects found for <strong>${escapeHtml(currentOwner)}</strong></p>
                        <p style="margin-top: 8px; font-size: 13px;">Make sure the user/org has public projects or you have access to their projects.</p>
                    </div>
                `;
          resultsSection.classList.add("visible");
          resultsCount.textContent = "";
          return;
        }

        resultsCount.textContent = `${projects.length} project${projects.length !== 1 ? "s" : ""} found`;

        projectsList.innerHTML = projects
          .map(
            (project) => `
                <div class="project-card" data-project='${JSON.stringify(project)}'>
                    <div class="project-header">
                        <div class="project-title">${escapeHtml(project.title)}</div>
                        <div class="project-number">#${project.number}</div>
                    </div>
                    ${
                      project.shortDescription
                        ? `
                        <div class="project-description">${escapeHtml(project.shortDescription)}</div>
                    `
                        : ""
                    }
                    <div class="project-meta">
                        <span class="project-badge ${project.closed ? "closed" : "open"}">
                            ${project.closed ? "Closed" : "Open"}
                        </span>
                        <span class="project-badge ${project.public ? "public" : "private"}">
                            ${project.public ? "Public" : "Private"}
                        </span>
                    </div>
                </div>
            `,
          )
          .join("");

        resultsSection.classList.add("visible");

        document.querySelectorAll(".project-card").forEach((card) => {
          card.addEventListener("click", () => {
            const project = JSON.parse(card.getAttribute("data-project"));
            searchSection.style.display = "none";
            resultsSection.classList.remove("visible");
            loadingProjectMessage.textContent = `Loading project ${escapeHtml(project.title)} of ${escapeHtml(currentOwner)}`;
            loadingProjectContainer.style.display = "block";
            vscode.postMessage({
              command: "selectProject",
              owner: currentOwner,
              project: project,
            });
          });
        });
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      ownerInput.focus();
    </script>
  </body>
</html>
